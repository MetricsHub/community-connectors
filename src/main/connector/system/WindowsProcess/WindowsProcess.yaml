extends:
- ../System/System
connector:
  displayName: WindowsProcess
  platforms: Any platform with Windows
  reliesOn: WMI
  information: Gives OS specific information and metrics
  detection:
    connectionTypes:
    - remote
    - local
    appliesTo:
    - nt
    criteria:
    - type: wmi
      namespace: root\CIMv2
      query: SELECT * FROM Win32_OperatingSystem
    tags: [ system, windows ]
monitors:
  process:
    simple:
      sources:
        processQuery:
          # 1 ProcessId;Name;ParentProcessId;ExecutablePath;ThreadCount;
          # 6 PageFaults;PageFileUsage;ReadOperationCount;ReadTransferCount;
          # 10 WriteOperationCount;WriteTransferCount;CommandLine;
          type: wmi
          namespace: root\CIMv2
          query: | 
            SELECT
            ProcessId,
            Name,
            ParentProcessId,
            ExecutablePath,
            ThreadCount,
            PageFaults,
            PageFileUsage,
            ReadOperationCount,
            ReadTransferCount,
            WriteOperationCount,
            WriteTransferCount,
            CommandLine
            FROM Win32_Process
          computes:
          - type: keepOnlyMatchingLines
            column: 2
            regExp: ${var::nameMatches}
          - type: keepOnlyMatchingLines
            column: 12
            regExp: ${var::commandMatches}   
      mapping:
        source: ${source::processQuery}
        attributes:
          id: $2
          system.process.path: $4
        metrics:
          system.process.process_id: $1
          system.process.parent_process_id: $3
          system.process.thread_count: $5
          system.process.page_faults: $6
          system.process.page_file_usage: $7
          system.process.read_operation_count: $8
          system.process.read_transfer_count: $9
          system.process.write_operation_count: $10
          system.process.write_transfer_count: $11